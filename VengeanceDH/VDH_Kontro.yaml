version: 0.1
author: Kontroved
spec: 581
name: Vengeance
description: First Alpha Version of Vengeance Demon Hunter Rotation
entry: main

morphs:
  throw_glaive: reavers_glaive

config:
  features2:
    label: "Features"
    type: multi_select
    options:
      - "Demon Spikes Spam"
      - "Meta DPS Usage"
      - "Fiery Brand Spam (DPS Boost)"
      - "Fel Devastation Movement Check"
      - "Sigil of Flame Movement Check"
      - "Felblade Melee Only"
      - "Pull MO Combat WIP"
      - "Infernal Strike player"
    default: [0,1,2,3,4,5,6,7]
  # Defensive Settings
  demon_spikes_hp_pct:
    label: "Demon Spikes HP%"
    type: slider
    min: 0
    max: 100
    default: 99

  fel_devastation_hp_pct:
    label: "Fel Devastation HP%"
    type: slider
    min: 0
    max: 100
    default: 60

  metamorphosis_hp_pct:
    label: "Metamorphosis HP%"
    type: slider
    min: 0
    max: 100
    default: 40

  darkness_hp_pct:
    label: "Darkness HP%"
    type: slider
    min: 0
    max: 100
    default: 30

  ttd_cd_usage:
    label: "TTD CD Usage Threshold"
    type: slider
    min: 0
    max: 30
    default: 10

variables:
    - has_defensive=buff.metamorphosis.up|debuff.fiery_brand.up
    - soul_fragments=buff.soul_fragments.stack
    - fury=player.fury.current
    #Features
    - demon_spikes_spam=config.features2.has(1)
    - meta_dps_usage=config.features2.has(2)
    - fel_devastation_movementcheck=config.features2.has(4)
    - sigil_movement_check=config.features2.has(5)
    - felblade_melee_only=config.features2.has(6)
    - fiery_brand_spam=config.features2.has(3)
    - pull_mo_combat=config.features2.has(7)
    - infernal_strike_player=config.features2.has(8)
    # TTD Logic Credit Munkey
    # - is_ttd_valid: time_to_die<9999&player.combat
    # - is_fight_remains_valid: fight_remains<9999&player.combat
    # - is_ttd_or_fm_above_threshold: ((fight_remains>=config.ttd_cd_usage&is_fight_remains_valid)|(time_to_die>config.ttd_cd_usage&is_ttd_valid))
lists:
  defensives:
    - demon_spikes,if=health.pct<=config.demon_spikes_hp_pct&buff.demon_spikes.remains<1&!buff.metamorphosis.up&!debuff.fiery_brand.up
    - fel_devastation,if=health.pct<=config.fel_devastation_hp_pct&!buff.metamorphosis.up&!debuff.fiery_brand.up
    - metamorphosis,if=health.pct<=config.metamorphosis_hp_pct&!buff.metamorphosis.up&!debuff.fiery_brand.up
    - darkness,if=health.pct<=config.darkness_hp_pct&!buff.metamorphosis.up&!debuff.fiery_brand.up

  interrupts:
    - disrupt,if=target.casting.interruptible&target.casting.elapsed>=0.5&target.casting.remains<1
    - disrupt.mouseover,if=mouseover.casting.interruptible&mouseover.casting.elapsed>=0.5&mouseover.casting.remains<1
    - disrupt.focus,if=focus.casting.interruptible&focus.casting.elapsed>=0.5&focus.casting.remains<1
      # CC Interrupt
    - imprison,if=interrupts.target.stun.ready&target.casting.elapsed>=0.5
    - imprison.mouseover,if=interrupts.mouseover.stun.ready&mouseover.casting.elapsed>=0.5
      # AoE Interrupt
    - chaos_nova,if=interrupts.8y.stun.count>=2&interrupts.8y.stun.ready&target.casting.elapsed>=0.5
    - sigil_of_silence.player,if=interrupts.8y.count>=2&chaos_nova.cooldown.remains<gcd+1&interrupts.8y.stun.ready
    - sigil_of_misery.player,if=interrupts.8y.stun.count>=2&chaos_nova.cooldown.remains<gcd+1&interrupts.8y.stun.ready

  pull_MO_Combat:
    - glaive.mouseover,if=player.combat&mouseover.alive&!mouseover.combat&config.features2.has(6)
    - torment.mouseover,if=player.combat&mouseover.alive&!mouseover.combat&config.features2.has(6)

  st:
    - demon_spikes,name="Demon Spikes spam",if=config.features2.has(0)
    - infernal_strike.player,name="Infernal Strike (ST - 1)",if=cooldown.infernal_strike.charges_fractional>=1.8&config.features2.has(7)&enemies.8y>=1&!player.moving
    - metamorphosis,if=!buff.metamorphosis.up&config.features2.has(1)&fight_remains>ttd_cd_usage&cooldown.spirit_bomb.remains>10
    - fracture,name="Fracture (ST - 3)",if=cooldown.fracture.charges_fractional>=1.8
    - spirit_bomb,name="Spirit Bomb (ST - 4)",if=buff.soul_fragments.stack>=4&debuff.fiery_brand.remains<4&active_enemies.8y>=1
    - fiery_brand,name="Fiery Brand (ST - 5)",if=!debuff.fiery_brand.up&config.features2.has(2)&fight_remains>ttd_cd_usage
    - spirit_bomb,name="Spirit Bomb (ST - 6)",if=buff.soul_fragments.stack=6
    - immolation_aura,name="Immolation Aura (ST - 7)",if=fight_remains>ttd_cd_usage
    - sigil_of_spite.player,name="Sigil of Spite (ST - 8)",if=buff.soul_fragments.stack<=4&!player.moving&active_enemies.8y>=1
    - soul_cleave,name="Soul Cleave (ST - 9)",if=buff.soul_fragments.stack>=1
    - fel_devastation,name="Fel Devastation (ST - 10)",if=fury>=50&(!player.moving|!config.features2.has(3))&enemies.8y>=1
    - soul_cleave,name="Soul Cleave (ST - 11)",if=buff.soul_fragments.stack=0
    - fracture,name="Fracture (ST - 12)",if=fury.deficit>20&buff.soul_fragments.stack<5
    - felblade,name="Felblade (ST - 13)",if=fury.deficit>15&((config.features2.has(5)&target.range<5&)|!config.features2.has(5))
    - throw_glaive,name="Throw Glaive (ST - 14)"
  aoe:
    - infernal_strike.player,name="Infernal Strike (AOE - 1)",if=cooldown.infernal_strike.charges_fractional>=1.8&config.features2.has(7)&enemies.8y>=1&!player.moving
    - metamorphosis,name="Metamorphosis (AOE - 2)",if=!buff.metamorphosis.up&cooldown.spirit_bomb.remains>10&fight_remains>ttd_cd_usage
    - fracture,name="Fracture (AOE - 3)",if=cooldown.fracture.charges_fractional>=1.8
    - spirit_bomb,name="Spirit Bomb (AOE - 4)",if=buff.soul_fragments.stack>=4&debuff.fiery_brand.remains<5
    - fiery_brand,name="Fiery Brand (AOE - 5)",if=!debuff.fiery_brand.up&fight_remains>ttd_cd_usage
    - spirit_bomb,name="Spirit Bomb (AOE - 6)",if=buff.soul_fragments.stack=6
    - immolation_aura,name="Immolation Aura (AOE - 7)",if=fight_remains>ttd_cd_usage
    - sigil_of_flame.player,name="Sigil of Flame (AOE - 8)",if=(!player.moving|!config.features2.has(4))&enemies.8y>=1
    - sigil_of_spite.player,name="Sigil of Spite (AOE - 9)",if=(buff.soul_fragments.stack<5&!player.moving)&enemies.8y>=1
    - felblade,name="Felblade (AOE - 10)",if=buff.soul_fragments.stack=6&fury<40&((config.features2.has(5)&target.range<5&)|!config.features2.has(5))
    - fel_devastation,name="Fel Devastation (AOE - 11)",if=(fury>=50&(!player.moving|!config.features2.has(3)))&enemies.8y>=1
    - soul_cleave,name="Soul Cleave (AOE - 12)",if=buff.soul_fragments.stack>0
    - fracture,name="Fracture (AOE - 13)",if=buff.soul_fragments.stack<5
    - felblade,name="Felblade (AOE - 14)",if=fury.deficit>=15&((config.features2.has(5)&target.range<5&)|!config.features2.has(5))
    - throw_glaive,name="Throw Glaive (AOE - 15)"

  taunt:
    - torment,name="Taunt",if=target.threat<2&target.combat
    #- throw_glaive,name="Glaive/taunt",if=target.threat<2&target.combat

  main:
    - call_action_list,name=spell_queue
    - call_action_list,name=sanity_checks
    - call_action_list,name=auto_heal
# Target Check
    - return,if=!target.valid&!((config.auto_combat.has(1)&target.quest_mob&target.enemy&!target.dead)|(config.auto_combat.has(2)&target.combat&target.enemy&!target.dead)|(config.auto_combat.has(3)&target.targeting_party&target.enemy&!target.dead))
    - return,if=!target.valid&config.auto_combat.has(0)
    - call_action_list,name=defensives
    - call_action_list,name=taunt
    - call_action_list,name=auto_target
    - target_enemy,name="target far",delay=1000,if=target.range>8&enemies.combat.8y>=1
    - call_action_list,name=interrupts
    - call_action_list,name=aoe,if=enemies.8y>=2
    - call_action_list,name=st
