version: 1.1
author: Kontroved
spec: 255
name: Survival Hunter by Kontro
description: Survival Hunter Rotation by Kontroved
# talents: C8PAAAAAAAAAAAAAAAAAAAAAAMWgBmxohBwMgtZmZmZmZ2mHAAAAAAgZMjZYGDjZYZMNDAAAAYAAssNzYbGzMYMGAMAmxwMLA
# Addon: Sentinel Hunter Tools
entry: main

morphs:
  takedown: moonlight_chakram 

movement_allowed:

config:
  features:
    label: "Features"
    type: multi_select
    options:
      - label: "Precombat Usage"
        value: 0
      - label: "Misdirect[\"Sentinel Hunter Tools ADDON\"]"
        value: 1
      - label: "target swap (Interrupt & Stun)"
        value: 2
    default: [0]
  Pets:
    label: "Pets"
    type: multi_select
    options:
      - label: "Pet 1"
        value: 0
      - label: "Pet 2"
        value: 1
      - label: "Pet 3"
        value: 2
      - label: "Pet 4"
        value: 3
      - label: "Pet 5"
        value: 4
    default: [0]
  # Defensive Settings
  survival_of_the_fittest_hp_pct:
    label: "Survival of the Fittest HP %"
    type: slider
    min: 0
    max: 100
    default: 45
  roar_of_sacrifice_hp_pct:
    label: "Roar of Sacrifice HP %"
    type: slider
    min: 0
    max: 100
    default: 30
  exhilaration_hp_pct:
    label: "Exhilaration HP %"
    type: slider
    min: 0
    max: 100
    default: 20

  ttd_cd_usage:
    label: "TTD CD Usage Threshold"
    type: slider
    min: 0
    max: 30
    default: 10

variables:
    #features
    auto_swap: config.features.has(2)
    pre_combat_usage: config.features.has(0)
    misdirect_usage: config.features.has(1)
    #pets
    call_pet1: config.Pets.has(0)
    call_pet2: config.Pets.has(1)
    call_pet3: config.Pets.has(2)
    call_pet4: config.Pets.has(3)
    call_pet5: config.Pets.has(4)
    #defensives
    survival_of_the_fittest_hp_pct: config.survival_of_the_fittest_hp_pct
    roar_of_sacrifice_hp_pct: config.roar_of_sacrifice_hp_pct
    exhilaration_hp_pct: config.exhilaration_hp_pct

lists:
  combat_checks:
    - return,if=!target.valid&!((config.auto_combat.has(1)&target.quest_mob&target.enemy&!target.dead)|(config.auto_combat.has(2)&target.combat&target.enemy&!target.dead)|(config.auto_combat.has(3)&target.targeting_party&target.enemy&!target.dead))
    - return,if=!target.valid&config.auto_combat.has(0)

  defensives:
    - roar_of_sacrifice,if=health.pct<=roar_of_sacrifice_hp_pct
    - survival_of_the_fittest,if=health.pct<=survival_of_the_fittest_hp_pct

  self_heals:
    - exhilaration,if=health.pct<=exhilaration_hp_pct

  interrupts:
      # Primary Interrupt
    - muzzle,name="Interrupt Target",if=config.interrupt_target&((config.interrupt_all&target.casting.interruptible)|interrupts.target.ready)&target.casting.elapsed>=0.2&(target.casting.remains<1|target.channeling)
    - muzzle.mouseover,name="Interrupt Mouseover",if=config.interrupt_mouseover&((config.interrupt_all&mouseover.casting.interruptible)|interrupts.mouseover.ready)&interrupts.mouseover.ready&mouseover.casting.elapsed>=0.2&(mouseover.casting.remains<1|mouseover.channeling)
    - muzzle.focus,name="Interrupt Focus",if=config.interrupt_focus&((config.interrupt_all&focus.casting.interruptible)|interrupts.focus.ready)&interrupts.focus.ready&focus.casting.elapsed>=0.2&(focus.casting.remains<1|focus.channeling)
       # CC Interrupt
    - intimidation,name="Stun Interrupt Target",if=interrupts.target.stun.ready&target.casting.elapsed>=0.1
    - target_enemy,delay=100,name="auto_target Interrupt",if=(interrupts.8y.ready|interrupts.8y.count>=1)&!interrupts.target.ready&cooldown.muzzle.ready&enemies.inrange(5)>=1&var.auto_swap
    - target_enemy,name="auto_target Stun",if=(interrupts.8y.stun.ready|interrupts.8y.coun>=1)&!interrupts.target.stun.ready&cooldown.intimidation.ready&enemies.inrange(10)>=1&var.auto_swap

  pre_combat:
    - hunters_mark,if=nameplates.debuff.hunters_mark.count=0
    - misdirection,ignore_usable=true,range_check=none,if=!buff.misdirection.up

  pet_stuff: 
    - mend_pet,if=pet.health.pct<40 
    - revive_pet,if=!pet.alive
    - call_pet_1,ignore_usable=true,range_check=none,if=!pet.exists&var.call_pet1
    - call_pet_2,ignore_usable=true,range_check=none,if=!pet.exists&var.call_pet2
    - call_pet_3,ignore_usable=true,range_check=none,if=!pet.exists&var.call_pet3
    - call_pet_4,ignore_usable=true,range_check=none,if=!pet.exists&var.call_pet4
    - call_pet_5,ignore_usable=true,range_check=none,if=!pet.exists&var.call_pet5

  utility:
    - tranquilizing_shot,if=target.target.has_magic_buff|target.target.has_magic_buff
    #- feign_death,if=
  st:
    - hunters_mark,if=nameplates.debuff.hunters_mark.count=0&fight_remains>ttd_cd_usage&fight_remains!=9999
    - misdirection,ignore_usable=true,if=!buff.misdirection.up&target.threat>=2&var.misdirect_usage
    - kill_command, if=buff.tip_of_the_spear.remains<gcd|!buff.tip_of_the_spear.up
    - wildfire_bomb, if=debuff.sentinels_mark.remains>gcd|cooldown.wildfire_bomb.full_recharge_time<=6|nameplates.debuff.sentinels_mark.count>=1
    - takedown, if=buff.tip_of_the_spear.up|(talent.twin_fangs&buff.tip_of_the_spear.stack=1)&target.range<=5
    - boomstick, if=cooldown.wildfire_bomb.full_recharge_time>9
    - moonlight_chakram, if=!talent.stalk_and_strike|cooldown.wildfire_bomb.full_recharge_time>9&target.range<=5
    - flamefang_pitch.player, if=(!talent.grenade_juggler|cooldown.wildfire_bomb.charges_fraction<=1.1)&enemies.8y>=1
    - raptor_strike

  aoe:
    - hunters_mark,if=nameplates.debuff.hunters_mark.count=0&fight_remains>ttd_cd_usage&fight_remains!=9999
    - misdirection,ignore_usable=true,if=!buff.misdirection.up&target.threat>=2&var.misdirect_usage
    - kill_command, if=buff.tip_of_the_spear.remains<gcd|!buff.tip_of_the_spear.up
    - wildfire_bomb, if=debuff.sentinels_mark.remains>gcd|cooldown.wildfire_bomb.full_recharge_time<=6|cooldown.boomstick.remains<(2*enemies.inrange(10))|nameplates.debuff.sentinels_mark.count>=1
    - boomstick, if=cooldown.wildfire_bomb.full_recharge_time>9
    - takedown, if=(!talent.twin_fangs&buff.tip_of_the_spear.up)|(talent.twin_fangs&buff.tip_of_the_spear.stack=1)&target.range<=5
    - wildfire_bomb, if=cooldown.wildfire_bomb.full_recharge_time<=1.5*gcd
    - moonlight_chakram, if=!talent.stalk_and_strike|cooldown.wildfire_bomb.full_recharge_time>9&target.range<=5
    - flamefang_pitch.player, if=(!talent.grenade_juggler|cooldown.wildfire_bomb.charges_fraction<=1.1)&enemies.8y>=1
    - raptor_strike

  main:
    - call_action_list,name=spell_queue
    - call_action_list,name=pet_stuff,if=state.rotation&!player.mounted
    - call_action_list,name=pre_combat,if=target.enemy&target.alive&var.pre_combat_usage&!player.combat&state.rotation
    - call_action_list,name=sanity_checks
    - call_action_list,name=auto_heal
    - call_action_list,name=combat_checks
    - call_action_list,name=interrupts
    - call_action_list,name=auto_target
    - call_action_list,name=defensives
    - call_action_list,name=self_heals
    - call_action_list,name=aoe,if=active_enemies>=2
    - call_action_list,name=st

